// 瀑布流
!function(d){function m(t,e,a,r){var n,i=1,o=1,h=t.width()-2,g=[],l=0,s=0,d=a.rowHeight;function f(t){a.maxRows&&o>a.maxRows||a.truncate&&t&&1<o?g[c][0].style.display="none":(g[c][4]&&(g[c][3].attr("src",g[c][4]),g[c][4]=""),g[c][0].style.width=n+"px",g[c][0].style.height=d+"px",g[c][0].style.display="block")}h||(h=t.width()-2);for(var u=0;u<e.length;u++)if(g.push(e[u]),h<=(l+=e[u][2]+a.margin)){var w=g.length*a.margin;i=(h-w)/(l-w),d=Math.ceil(a.rowHeight*i);for(var c=s=0;c<g.length;c++)h<(s+=(n=Math.ceil(g[c][2]*i))+a.margin)&&(n-=s-h),f();g=[],l=0,o++}for(c=0;c<g.length;c++){n=Math.floor(g[c][2]*i);Math.floor(a.rowHeight*i);f(!0)}r||h==t.width()||m(t,e,a,!0)}d.fn.flexImages=function(t){var s=d.extend({container:".item",object:"img",rowHeight:180,maxRows:0,truncate:0},t);return this.each(function(){var t=d(this),e=d(t).find(s.container),a=[],r=(new Date).getTime(),n=window.getComputedStyle?getComputedStyle(e[0],null):e[0].currentStyle;s.margin=(parseInt(n.marginLeft)||0)+(parseInt(n.marginRight)||0)+(Math.round(parseFloat(n.borderLeftWidth))||0)+(Math.round(parseFloat(n.borderRightWidth))||0);for(var i=0;i<e.length;i++){var o=e[i],h=parseInt(o.getAttribute("data-w")),g=h*(s.rowHeight/parseInt(o.getAttribute("data-h"))),l=d(o).find(s.object);a.push([o,h,g,l,l.data("src")])}m(t,a,s),d(window).off("resize.flexImages"+t.data("flex-t")),d(window).on("resize.flexImages"+r,function(){m(t,a,s)}),t.data("flex-t",r)})}}(jQuery);